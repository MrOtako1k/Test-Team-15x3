<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST TEAM - لوحة تحكم الأدمن</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            direction: rtl;
            line-height: 1.6;
        }

        /* خلفية متحركة حديثة */
        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            z-index: -1;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            animation: float 8s infinite linear;
            opacity: 0.6;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
                transform: scale(1);
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg) scale(0);
                opacity: 0;
            }
        }

        /* Header */
        .header {
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .logo {
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
        }

        .admin-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .logout-btn {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: rgba(26, 26, 26, 0.6);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 25px;
            padding: 35px;
            text-align: center;
            transition: all 0.4s ease;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.2);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 25px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            position: relative;
            z-index: 1;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            font-size: 1.1rem;
            color: #ccc;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        /* Submissions Section */
        .submissions-section {
            background: rgba(26, 26, 26, 0.6);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 25px;
            padding: 40px;
            backdrop-filter: blur(20px);
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 35px;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .section-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        /* Filters */
        .filters-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
            transform: translateY(-2px);
        }

        /* Submissions Grid */
        .submissions-grid {
            display: grid;
            gap: 25px;
        }

        .submission-card {
            background: rgba(15, 15, 15, 0.8);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .submission-card:hover {
            transform: translateY(-3px);
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.1);
        }

        .submission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
        }

        .submission-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .submission-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
        }

        .submission-details h3 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .submission-meta {
            color: #888;
            font-size: 0.9rem;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            text-align: center;
        }

        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.5);
        }

        .status-approved {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .status-rejected {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.5);
        }

        /* Submission Content */
        .submission-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .answer-group {
            background: rgba(26, 26, 26, 0.5);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .question-text {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .answer-text {
            font-size: 1rem;
            color: #fff;
            font-weight: 500;
            line-height: 1.4;
        }

        /* Actions */
        .submission-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid rgba(102, 126, 234, 0.2);
        }

        .action-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .action-btn.approve {
            background: linear-gradient(135deg, #4caf50, #45a049);
        }

        .action-btn.reject {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .action-btn.view {
            background: linear-gradient(135deg, #2196f3, #1976d2);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 25px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
        }

        .close-btn {
            background: none;
            border: none;
            color: #888;
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #fff;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .empty-message {
            font-size: 1rem;
            line-height: 1.6;
        }

        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 20px;
                flex-direction: column;
                gap: 15px;
            }

            .main-content {
                padding: 30px 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .submissions-section {
                padding: 25px 20px;
            }

            .submission-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .submission-content {
                grid-template-columns: 1fr;
            }

            .submission-actions {
                justify-content: center;
                flex-wrap: wrap;
            }

            .filters-container {
                justify-content: center;
            }

            .modal-content {
                padding: 30px 20px;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="particles" id="particles"></div>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">TEST TEAM</div>
                <div class="admin-badge">لوحة تحكم الأدمن</div>
            </div>
            <div class="user-info">
                <div class="user-avatar">👑</div>
                <span id="adminName">مرحباً، أدمن</span>
                <button class="logout-btn" onclick="logout()">تسجيل خروج</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">📋</div>
                <div class="stat-number" id="totalSubmissions">-</div>
                <div class="stat-label">إجمالي الطلبات</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">⏳</div>
                <div class="stat-number" id="pendingSubmissions">-</div>
                <div class="stat-label">قيد المراجعة</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">✅</div>
                <div class="stat-number" id="approvedSubmissions">-</div>
                <div class="stat-label">تم القبول</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">❌</div>
                <div class="stat-number" id="rejectedSubmissions">-</div>
                <div class="stat-label">تم الرفض</div>
            </div>
        </div>

        <!-- Submissions Section -->
        <div class="submissions-section">
            <h2 class="section-title">
                <div class="section-icon">📊</div>
                طلبات الانضمام
            </h2>
            
            <!-- Filters -->
            <div class="filters-container">
                <button class="filter-btn active" onclick="filterSubmissions('all')">الكل</button>
                <button class="filter-btn" onclick="filterSubmissions('pending')">قيد المراجعة</button>
                <button class="filter-btn" onclick="filterSubmissions('approved')">مقبول</button>
                <button class="filter-btn" onclick="filterSubmissions('rejected')">مرفوض</button>
            </div>
            
            <!-- Submissions Grid -->
            <div class="submissions-grid" id="submissionsGrid">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <div>جاري تحميل الطلبات...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal لعرض التفاصيل -->
    <div class="modal" id="detailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">تفاصيل الطلب</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- محتوى المودال -->
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2'

        // إعداد Supabase
        const supabaseUrl = 'YOUR_SUPABASE_URL'
        const supabaseKey = 'YOUR_SUPABASE_ANON_KEY'
        const supabase = createClient(supabaseUrl, supabaseKey)

        const questions = [
            "ACHENO SMIYTEK؟",
            "CHE7AL F3EMREK",
            "WACHE KENTI DA5EL M3A CHI TEAM O5ERA؟",
            "ACHEMEN JIHAZ 3ENDEK",
            "ACHENO KAT3ERF DIR",
            "ACHE NAHIYA TEAM LI KENTI DA5OL M3AHA",
            "WACHE FAYT LIK DEVLOPETI CHI L3AYBA",
            "ACHE NAHOWA MASAR DIRASI DYALK",
            "WACHE KAT3ETA9ED ILA D5OLTI AL HAD TEAM WACHE HATSTAMR FIHA",
            "ACHE NAHIYA RISALA DYALK LI BITI TWOJHEHA AL MASEOLIN",
            "WACHE HATB9A DAYMAN DAYR TAG 15x3 LILABADE",
            "3TINA NMRA DYALK BACHE ANTWASLO M3AKE"
        ];

        let currentFilter = 'all';
        let submissions = [];

        // إنشاء الجسيمات المتحركة
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 40;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 6 + 8) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // تحميل الطلبات من Supabase
        async function loadSubmissions() {
            try {
                const { data, error } = await supabase
                    .from('submissions')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    throw error;
                }

                submissions = data || [];
                renderSubmissions();
                updateStats();
            } catch (error) {
                console.error('خطأ في تحميل الطلبات:', error);
                showError('حدث خطأ في تحميل الطلبات. يرجى المحاولة مرة أخرى.');
            }
        }

        // عرض رسالة خطأ
        function showError(message) {
            const grid = document.getElementById('submissionsGrid');
            grid.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">⚠️</div>
                    <div class="empty-title">خطأ في التحميل</div>
                    <div class="empty-message">${message}</div>
                </div>
            `;
        }

        // عرض الطلبات
        function renderSubmissions(filter = 'all') {
            const grid = document.getElementById('submissionsGrid');
            const filteredSubmissions = filter === 'all' ? submissions : submissions.filter(s => s.status === filter);
            
            grid.innerHTML = '';
            
            if (filteredSubmissions.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📭</div>
                        <div class="empty-title">لا توجد طلبات</div>
                        <div class="empty-message">
                            ${filter === 'all' ? 'لم يتم استلام أي طلبات بعد' : `لا توجد طلبات ${getStatusText(filter)}`}
                        </div>
                    </div>
                `;
                return;
            }
            
            filteredSubmissions.forEach(submission => {
                const card = document.createElement('div');
                card.className = 'submission-card';
                card.innerHTML = `
                    <div class="submission-header">
                        <div class="submission-info">
                            <div class="submission-avatar">
                                ${submission.name.charAt(0)}
                            </div>
                            <div class="submission-details">
                                <h3>${submission.name}</h3>
                                <div class="submission-meta">
                                    ${submission.age} سنة • ${submission.device} • ${new Date(submission.created_at).toLocaleDateString('ar-SA')}
                                </div>
                            </div>
                        </div>
                        <div class="status-badge status-${submission.status}">
                            ${getStatusText(submission.status)}
                        </div>
                    </div>
                    
                    <div class="submission-content">
                        <div class="answer-group">
                            <div class="question-text">المهارات</div>
                            <div class="answer-text">${submission.skills}</div>
                        </div>
                        <div class="answer-group">
                            <div class="question-text">الدور المطلوب</div>
                            <div class="answer-text">${submission.team_role}</div>
                        </div>
                        <div class="answer-group">
                            <div class="question-text">مجال الدراسة</div>
                            <div class="answer-text">${submission.study_field}</div>
                        </div>
                        <div class="answer-group">
                            <div class="question-text">الرسالة</div>
                            <div class="answer-text">${submission.message}</div>
                        </div>
                    </div>
                    
                    <div class="submission-actions">
                        <button class="action-btn view" onclick="viewSubmission('${submission.id}')">
                            عرض التفاصيل
                        </button>
                        ${submission.status === 'pending' ? `
                            <button class="action-btn approve" onclick="approveSubmission('${submission.id}')">
                                قبول
                            </button>
                            <button class="action-btn reject" onclick="rejectSubmission('${submission.id}')">
                                رفض
                            </button>
                        ` : ''}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // تصفية الطلبات
        window.filterSubmissions = function(filter) {
            currentFilter = filter;
            
            // تحديث أزرار التصفية
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderSubmissions(filter);
        }

        // الحصول على نص الحالة
        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'قيد المراجعة';
                case 'approved': return 'تم القبول';
                case 'rejected': return 'تم الرفض';
                default: return 'غير محدد';
            }
        }

        // عرض تفاصيل الطلب
        window.viewSubmission = function(id) {
            const submission = submissions.find(s => s.id === id);
            if (!submission) return;
            
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div style="margin-bottom: 30px;">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 25px;">
                        <div class="submission-avatar" style="width: 60px; height: 60px; font-size: 1.5rem;">
                            ${submission.name.charAt(0)}
                        </div>
                        <div>
                            <h3 style="font-size: 1.5rem; margin-bottom: 5px;">${submission.name}</h3>
                            <div style="color: #888;">رقم المرجع: ${submission.reference}</div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; gap: 20px;">
                    ${questions.map((question, index) => {
                        const answers = [
                            submission.name,
                            submission.age,
                            submission.previous_team,
                            submission.device,
                            submission.skills,
                            submission.team_role,
                            submission.games_developed,
                            submission.study_field,
                            submission.commitment,
                            submission.message,
                            submission.keep_tag,
                            submission.phone_number
                        ];
                        
                        return `
                            <div class="answer-group">
                                <div class="question-text">${question}</div>
                                <div class="answer-text">${answers[index] || 'غير محدد'}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                ${submission.status === 'pending' ? `
                    <div style="display: flex; gap: 15px; margin-top: 30px; justify-content: center;">
                        <button class="action-btn approve" onclick="approveSubmission('${submission.id}'); closeModal();">
                            قبول الطلب
                        </button>
                        <button class="action-btn reject" onclick="rejectSubmission('${submission.id}'); closeModal();">
                            رفض الطلب
                        </button>
                    </div>
                ` : ''}
            `;
            
            document.getElementById('detailsModal').style.display = 'block';
        }

        // إغلاق المودال
        window.closeModal = function() {
            document.getElementById('detailsModal').style.display = 'none';
        }

        // قبول الطلب
        window.approveSubmission = async function(id) {
            if (confirm('هل أنت متأكد من قبول هذا الطلب؟')) {
                try {
                    const { error } = await supabase
                        .from('submissions')
                        .update({ status: 'approved' })
                        .eq('id', id);

                    if (error) {
                        throw error;
                    }

                    // تحديث البيانات المحلية
                    const submissionIndex = submissions.findIndex(s => s.id === id);
                    if (submissionIndex !== -1) {
                        submissions[submissionIndex].status = 'approved';
                    }

                    renderSubmissions(currentFilter);
                    updateStats();
                    alert('تم قبول الطلب بنجاح!');
                } catch (error) {
                    console.error('خطأ في قبول الطلب:', error);
                    alert('حدث خطأ في قبول الطلب. يرجى المحاولة مرة أخرى.');
                }
            }
        }

        // رفض الطلب
        window.rejectSubmission = async function(id) {
            if (confirm('هل أنت متأكد من رفض هذا الطلب؟')) {
                try {
                    const { error } = await supabase
                        .from('submissions')
                        .update({ status: 'rejected' })
                        .eq('id', id);

                    if (error) {
                        throw error;
                    }

                    // تحديث البيانات المحلية
                    const submissionIndex = submissions.findIndex(s => s.id === id);
                    if (submissionIndex !== -1) {
                        submissions[submissionIndex].status = 'rejected';
                    }

                    renderSubmissions(currentFilter);
                    updateStats();
                    alert('تم رفض الطلب.');
                } catch (error) {
                    console.error('خطأ في رفض الطلب:', error);
                    alert('حدث خطأ في رفض الطلب. يرجى المحاولة مرة أخرى.');
                }
            }
        }

        // تحديث الإحصائيات
        function updateStats() {
            const total = submissions.length;
            const pending = submissions.filter(s => s.status === 'pending').length;
            const approved = submissions.filter(s => s.status === 'approved').length;
            const rejected = submissions.filter(s => s.status === 'rejected').length;

            document.getElementById('totalSubmissions').textContent = total;
            document.getElementById('pendingSubmissions').textContent = pending;
            document.getElementById('approvedSubmissions').textContent = approved;
            document.getElementById('rejectedSubmissions').textContent = rejected;
        }

        // تسجيل الخروج
        window.logout = function() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                document.body.style.transition = 'opacity 0.5s ease';
                document.body.style.opacity = '0';
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 500);
            }
        }

        // تحديد اسم الأدمن
        function setAdminName() {
            const adminName = localStorage.getItem('adminName') || 'أدمن';
            document.getElementById('adminName').textContent = `مرحباً، ${adminName}`;
        }

        // إغلاق المودال عند الضغط خارجه
        window.onclick = function(event) {
            const modal = document.getElementById('detailsModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // تحديث الطلبات كل 30 ثانية
        function autoRefresh() {
            loadSubmissions();
        }

        // تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            setAdminName();
            loadSubmissions();
            
            // تحديث تلقائي كل 30 ثانية
            setInterval(autoRefresh, 30000);
        });
    </script>
</body>
</html>
